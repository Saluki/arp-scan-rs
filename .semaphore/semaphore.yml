version: v1.0
name: Rust
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
  containers:
    - name: main
      image: 'registry.semaphoreci.com/rust:1.47'
blocks:
  - name: Test release
    task:
      jobs:
        - name: Cargo test
          commands:
            - checkout
            - cargo build --verbose
            - cargo test --verbose
  - name: Build release
    task:
      jobs:
        - name: Configure
          commands:
            - rustup target add x86_64-unknown-linux-musl
        - name: Build
          commands:
            - cargo build --target=x86_64-unknown-linux-musl --locked
        - name: Push artificact
          commands:
            - artifact push job target/x86_64-unknown-linux-musl/release/arp-scan
